{% load staticfiles %}

<!DOCTYPE html>
<html lang="en">

{% include '_header.html' %}

<body>
<div id="wrapper">
    {% include '_navbar.html' %}
    <div id="page-wrapper">
        <div class="row">
            <h1 class="page-header"><i class="glyphicon glyphicon-globe"></i> Shodan Vulnerability Filter
                    <small>Only for Shodan-Masscan</small>
            </h1>
        </div>
        <div class="col-md-7 col-md-offset-2">
            <div class="form-group">
                <form action="{% url 'vulnerability_filter'%}" method="post" data-toggle="validator">
                    {% csrf_token %}
                    {% block success_message %}
                        {% if success_message %}
                            <div class='alert alert-success'>
                                {{ success_message }}
                            </div>
                        {% endif %}
                    {% endblock %}
                    {% block error_message %}
                        {% if error_message %}
                            <div class='alert alert-danger'>{{ error_message }}</div>{% endif %}
                    {% endblock %}

                    <div class="form-group">
                        <label for="service">Service:</label>
                        <input class="form-control" id="service" placeholder="Samba" name="service" required>
                    </div>
                    <div class="form-group">
                        <label>Affected Range</label>
                        <div class="form-inline">
                            <input class="form-control" name="lowest_version" placeholder="0.0.1" required>
                            <input class="form-control" name="highest_version" placeholder="3.6.25" required>
                        </div>
                    </div>
                    <div class="row">
                        <button class="btn btn-default pull-right">Add to filter</button>
                    </div>
                </form>
            </div>
        </div>
        <div class="col-md-7 col-md-offset-2">
            <table id="table">
                <thead>
                <tr>
                    <th>#</th>
                    <th>Vulnerability</th>
                    <th>Lowest Version</th>
                    <th>Highest Version</th>
                    <th>Action</th>
                </tr>
                </thead>

                <tbody>
                {% for object in vulnerability_filer_objects %}
                    <tr>
                    <td>{{ forloop.counter }}</td>
                    <td>{{ object.service }}</td>
                    <td>{{ object.lowest_version }}</td>
                    <td>{{ object.highest_version }}</td>
                    <td class="text-center">{{ object.id }}</td>
                {% endfor %}
                </tr>
                </tbody>
            </table>
        </div>

    </div>

    {% include '_scripts.html' %}
</div>

</div>
<script>
    $('#table').bootstrapTable({

        columns: [
            {
                title: '#',
                align: 'center'
            },

            {
                title: 'Service',
                sortable: true,
                width: '40%'
            },
            {
                title: 'Lowest Version',
                sortable: true,
                width: '30%'
            },
            {
                title: 'Highest Version',
                sortable: true,
                width: '30%'
            },
            {
                title: 'Action',
                sortable: false,
                align: 'center',
                formatter: 'LinkFormatter'
            }
        ]
    });

    function LinkFormatter(value, row, index) {
        var link = '{% url 'vulnerability_filter_delete' 12345 %}'.replace(12345, value);
        console.log(link);
        return [
            '<a class="remove ml10" href=' + link + ' title="Remove">',
            //'<a class="remove ml10" href={% url 'vulnerability_filter_delete' id=1%}' + value + ' title="Remove">',
            '<i class="glyphicon glyphicon-remove"></i>',
            '</a>'
        ].join('')

    }

</script>
</body>
